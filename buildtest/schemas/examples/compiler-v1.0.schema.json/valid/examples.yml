version: "1.0"
buildspecs:
  gnu_example:
    executor: local.bash
    type: compiler
    description: "gnu example with modules, and cflags example"
    module:
      purge: False
      load: [gcc/6.4.0]
    source: src/hello.c
    compilers:
      name: [gcc]
      config:
        gcc@8.4.0:
          cflags: "-O3"


  intel_example:
    executor: local.bash
    type: compiler
    description: "intel example using cflags"
    source: src/hello.c
    compilers:
      name: [intel]
      config:
        intel@2018:
          cflags: "-O1"

  pgi_example:
    executor: local.bash
    type: compiler
    description: "pgi example using cxxflags, ldflags key"
    source: src/hello.cpp
    compilers:
      name: ["^(pgi|PrgEnv)"]
      default:
        pgi:
          cxxflags: "-O1"
          ldflags: "-lm"
      config:
        pgi@18.1:
          module:
            swap: [PrgEnv-gnu, PrgEnv-pgi]
            load: [pgi/18.1]
        pgi@18.2:
          module:
            swap: [PrgEnv-gnu, PrgEnv-pgi]
            load: [pgi/18.2]

  cray_example:
    executor: local.bash
    type: compiler
    description: "cray example using fflags and cppflags"
    source: src/hello.f90
    compilers:
      name: ["PrgEnv-cray"]
      default:
        cray:
          fflags: "-O1"
      config:
        PrgEnv-cray@2.6.2:
          module:
            swap: [PrgEnv-intel, PrgEnv-cray/2.6.2]

  sbatch_example:
    type: compiler
    description: sbatch example to configure #SBATCH options
    executor: local.bash
    sbatch:
      - "-t 10"
      - "-n 2"
    source: src/hello.f90
    compilers:
      name: ["PrgEnv-cray"]
      default:
        cray:
          fflags: "-O1"
      config:
        PrgEnv-cray@2.6.2:
          module:
            swap: [PrgEnv-intel, PrgEnv-cray/2.6.2]
    status:
      slurm_job_state: "COMPLETED"

  bsub_example:
    type: compiler
    description: bsub example to configure #BSUB options
    executor: local.bash
    bsub:
      - "-W 00:30"
      - "-N 2"
    source: "src/hello.cpp"
    compilers:
      name: [intel]
      config:
        intel@2019:
          cxxflags: "-O1"

  batch_example:
    type: compiler
    description: example using batch field
    executor: local.bash
    batch:
      "timelimit": "30"
      "nodecount": "2"
      "queue": "batch"
      "account": "biology"
    source: "src/hello.cpp"
    compilers:
      name: [intel]
      config:
        intel@2019:
          cxxflags: "-O1"

  args_example:
    type: compiler
    description: Launcher example
    executor: local.bash
    source: "src/hello.cpp"
    compilers:
      name: [intel]
      config:
        intel@2019:
          cxxflags: "-O1"
    run:
      args: "1 2 4"

  mpi_launcher_example:
    type: compiler
    description: mpi launcher example
    executor: local.bash
    source: "src/hello.cpp"
    compilers:
      name: [gcc]
      config:
        gcc@7.3.0:
          cflags: "-O3"
          cxx: mpicxx
    run:
      launcher: mpirun -np 2

  pre_post_build_run_sections:
    type: compiler
    description: Run commands pre and post build and run section
    executor: local.bash
    pre_build: echo "pre-build section"
    source: "src/hello.cpp"
    compilers:
      name: [gcc]
      config:
        gcc@7.3.0:
          cflags: "-O3"

    post_build: echo "post-build section"
    pre_run: echo "pre-run section"
    run:
      launcher: mpirun -np 2
    post_run: echo "post-run section"

  multi_compilers:
    type: compiler
    description: Select one or more compilers to run test
    executor: local.bash
    source: "src/hello.cpp"
    compilers:
      name: [gcc, intel]
      include: [gcc@7.5.0]
      exclude: [intel@18]
      default:
        gcc:
          cflags: "-O3"
        intel:
          cflags: "-O2"
      config:
        gcc@7.5.0:
          cflags: "-O3"
          cc: gcc
          module:
            load: [gcc/7.5.0]
        intel@17:
          module:
            load: [intel/2017]
        intel@18:
          module:
            load: [intel/2018]